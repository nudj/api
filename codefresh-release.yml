version: '1.0'

steps:

  # github_release:
  #   title: Github Release
  #   description: Release the latest tag on Github
  #   image: nudj/create-github-release
  #   working_directory: 'IMAGE_WORK_DIR'
  #   environment:
  #     - TOKEN=${{GITHUB_ACCESS_TOKEN}}
  #   commands:
  #     - /bin/sh -c "node . ${{CF_REPO_OWNER}}/${{CF_REPO_NAME}}"

  build:
    title: Build
    type: build
    image_name: nudj/api
    tag: production
    dockerfile: Dockerfile
    build_arguments:
      - NPM_TOKEN=${{NPM_TOKEN}}

  push:
    title: Push
    type: push
    candidate: ${{build}}
    tag: ${{CF_BRANCH}}
    registry: ecr

  # publish:
  #   title: Publish package to npm
  #   image: ${{build_production}}
  #   working_directory: 'IMAGE_WORK_DIR'
  #   environment:
  #     - NPM_TOKEN=${{NPM_TOKEN}}
  #   commands:
  #     - npm --no-git-tag-version version ${{CF_BRANCH}}
  #     - npm publish
  #
  # deploy:
  #   image: nudj/devops:aws
  #   working_directory: IMAGE_WORK_DIR
  #   description: Deploy web service
  #   commands:
  #     - ./scripts/deploy-service.sh -e production -c api -v core-vpc
